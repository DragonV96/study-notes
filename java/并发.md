



[影响线程并发性的因素](#影响线程并发性的因素)

- [1 上下文切换](#1-上下文切换)
- [2 死锁](#2-死锁)
- [3 资源限制](#3-资源限制)

[并发机制的底层实现原理](#并发机制的底层实现原理)

- [1 volatile](#1-volatile)
- [2 synchronized](#2-synchronized)
- [3 原子操作](#3-原子操作)



# java并发

## 影响线程并发性的因素

### 1 上下文切换

**1. 概念**

CPU在执行A任务后且在切换到B任务前，会保存A任务的状态，以便下次切回A任务时可以加载到这个任务的状态，这个从保存到再加载的过程就是上下文切换。

**2. 测试工具**

- Lmbench3 可以测量上下文切换的时长（工具）
- vmstat 可以测量上下文切换的次数（linux命令）

**3. 优化方案**

减少上下文切换的优化方案：

- 无锁并发编程：将数据的ID按照Hash算法取模分段，不同线程处理不同段的数据
- CAS算法：Atomic包使用CAS算法更新数据，无需加锁
- 使用最少线程：避免创建不需要的线程
- 使用协程：单线程里实现多任务的调度，并再单线程里维持多个任务间的切换

### 2 死锁

**1. 概念**

两个或两个以上的线程在执行过程中，由于竞争资源或者由于彼此通信而造成的一种阻塞的现象，若无外力作用，它们都将无法推进下去。

**2. 优化方案**

避免死锁的方式：

- 避免一个线程同时获取多个锁
- 避免一个线程在锁内同时占用多个资源，尽量保证每个锁只占用一个资源
- 使用定时锁时，用lock.tryLock(timeout)来替代使用内部锁机制
- 数据库锁的加锁和解锁必须在一个数据库连接里，否则会出现解锁失败的情况

### 3 资源限制

**1. 概念**

程序的执行速度受限于计算机硬件资源或软件资源。

**2. 优化方案**

- 硬件资源限制：搭建服务器集群或使用ODPS、Hadoop，不同机器处理不同数据
- 软件资源限制：使用资源池将资源复用

## 并发机制的底层实现原理

### 1 volatile

**1. 概念**

Java线程内存模型将确保所有线程看到volatile修饰的变量的值是一致的。

**2. 优化方案**

### 2 synchronized

**1. 概念**

### 3 原子操作

**1. 概念**